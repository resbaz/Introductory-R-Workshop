---
layout:   page
title:    R for reproducible scientific analysis
subtitle: Writing reports with R markdown
minutes:  70
---

As a tool for analysing and manipulating data, R provides a lean and proficient experience where every part in the process is represented by code that can be run and rerun to produce consistent results. This is an important advantage of the R system; instructions at every step can be noted and commented so a reader knows what purpose each serves, and an analysis can be reproduced by someone else by running the same code on the data.

Presenting your results can be tricky however, as the output generated by R isn't necessarily intuitive to the casual observer. Additionally, manually saving plots and pasting bits of text from R to a document adds extra steps requiring time to redo whenever the data is updated potentially leading to the introduction of errors.

[R markdown](http://rmarkdown.rstudio.com/) is a system where reports and documents can be created from text and code. It is a flexible way of generating files directly from your analysed data to produce something in a format that you can present to colleagues, supervisors and audiences. 


# What is R markdown?

R markdown is a package within R that parses your text and code to a markdown format, which can be then converted to other formats using pandoc.

Rmd -> knitr -> markdown -> pandoc -> html/pdf/slides/txt/doc

As with standard R scripts, being written in a unicode format allows you to use any text editor to view and edit R markdown documents; you are not forced into using one particular program, and it will work across operating systems. It also fits nicely into version control systems like git, allowing you to keep a record of and track changes.

### Some definitions

[markdown](https://en.wikipedia.org/wiki/Markdown): A lightweight markup language with plain text formatting syntax. Rich text can be formatted using tags: `*italics*` for *italics*.

[pandoc](http://pandoc.org): Software to convert files from one markup format into another.


# Getting started

R markdown is well supported in the RStudio platform, available with a default installation. Output to particular formats may need installation of [pandoc](http://pandoc.org/installing.html) or [LaTeX](https://www.latex-project.org/get/).

File > New File > R Markdown

Otherwise, R markdown can be installed using the command `install.packages("rmarkdown")`

Within RStudio, a template report is typically created including text, code and plots. You can safely remove or replace sections that you don't need. 


# Rmarkdown structure

There are three important types of structures within a R markdown document

- YAML
- Text
- Code


### YAML

"YAML ain't markup language"

Positioned at the beginning of the document, the YAML header is a section where key-values are defined, representing certain terms as well as how the R markdown document will be processed are specified. The beginning and end of the YAML header are always denoted by three dashes (`---`).

Theming the document, setting the output format and whether certain elements should be generated (such as menus) is set here. 


```r
---
title: "Untitled"
output: html_document
---
```

### Text

Explanatory text can be written throughout the document in a markdown format. Markdown is widely used, originally designed for translating plain text to HTML commands for websites. It also has many applications, from forums and discussion sites to laying out READMEs on Github. 

How rich text is formatted is defined by certain symbols. For example, previously we used asterisks (`*`) to mark out the text to be *italicised*. **Bold text** can be marked out with two asterisks (`**`) on either side of the text (`**Bold text**`).


### Code

Code within a R markdown document can be placed either inline or in a block, which R knows then to process. Where code begins and ends is defined by the grave symbol (`     ` `). As R markdown can process different languages (e.g. R and python), the language in which your code is written should be specified to tell R how to handle it. 

Inline code is placed within a paragraph, and formatted as such. For example, to display all numbers from `1:4`, use `` `r 1:4` `` to produce: 1, 2, 3, 4.

Code chunks are specified using three grave symbols at the beginning and at the end (`     ``` `). Again, the language of the code needs to be specified at the start of the code block: `` ```{r} ``. To redo the previous example in a code chunk:



````
```{r}
1:4
```
````

This will produce the following output:


```
## [1] 1 2 3 4
```


# Bringing it together

When your document is ready, signal R to render it by clicking the "knit" button at the top of the RStudio interface. By default, a HTML file (a webpage) is generated, but you have the option of producing other formats as well. 

Altenatively, the following command can be run in the R session window.

`render("yourfile.Rmd")`


### Exercise 1

Produce a report using R markdown with one of the plots you previously generated using `ggplot2`. In a paragraph accompanying your graphic, emphasise the main findings of your analysis.

NB: All data used to generate the report must be read in (and transformed if necessary) within the R markdown document


# Customisation

Options exist for customising each of the structures in R markdown.


### YAML

There are a number of options supported by the R markdown-pandoc system to set within the YAML header, at the beginning of your document. Some of these are only available for certain formats (a navigation bar for example is available for websites, but not standard documents). A list of them is available [from the pandoc reference guide](http://pandoc.org/MANUAL.html#variables-set-by-pandoc). 

Specifying the output format is important to define format-specific variables and how R markdown should handle them. A list of these is available [from the RStudio R markdown documentation](http://rmarkdown.rstudio.com/lesson-9.html); some of the more common ones might include:

- html_document - HTML documents
- word_document - Microsoft Word compatible document
- pdf_document - PDF document, requires installation of LaTeX
- ioslides_presentation - HTML based presentation

The flexibility of R markdown lends itself well to the numerous applications. Modifying the appearance tends to be output specific, so consult the relevant output format documentation in the Rstudio R markdown documentation above. 


### Text and tables

Customisation of text follows standard markdown conventions, a quick summary available [here](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet). 

Greek symbols and maths is supported using MathJax, and can be inserted inline (within a paragraph) or within it's own block. Surround your inline maths with a dollar sign (`$`) to indicate to R that you would like to process it as such. For example, `$e = mc^2$` will produce $e = mc^2$. Alternatively, in surround it with two dollar signs (`$$`) to produce:

$$e = mc^2$$

Within R, you're often dealing with tabulated data (such as that from spreadsheets). You're able to quite easily display the raw data as code output


```r
# Display the first few rows of the mtcars dataset
head(mtcars)
```

```
##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
```

Alternatively, R markdown is able to process it to produce a nicely formatted version of the table. Within the markdown specifications, tables are defined by producing within your code a specifically laid out manner, with your headings and columns separated by `-` and `|` symbols respectively.

```
| Heading 1   | Heading 2   | Heading 3   |
|-------------|-------------|-------------|
| Col 1 row 1 | Col 2 row 1 | Col 3 row 1 |
| Col 1 row 2 | Col 2 row 2 | Col 3 row 2 |
```

Doing this manually for your data would be tedious and defeat the R markdown-will-make-generating-reports-easier purpose we've been seeking. Thankfully, there are ways of programmatically producing the required format using packages! Popular ways of doing this include `kable` (within the `knitr` package), `xtables` and `pander`


```r
# Display the first few rows of the mtcars dataset using kable
library(knitr)
kable(head(mtcars))
```



|                  |  mpg| cyl| disp|  hp| drat|    wt|  qsec| vs| am| gear| carb|
|:-----------------|----:|---:|----:|---:|----:|-----:|-----:|--:|--:|----:|----:|
|Mazda RX4         | 21.0|   6|  160| 110| 3.90| 2.620| 16.46|  0|  1|    4|    4|
|Mazda RX4 Wag     | 21.0|   6|  160| 110| 3.90| 2.875| 17.02|  0|  1|    4|    4|
|Datsun 710        | 22.8|   4|  108|  93| 3.85| 2.320| 18.61|  1|  1|    4|    1|
|Hornet 4 Drive    | 21.4|   6|  258| 110| 3.08| 3.215| 19.44|  1|  0|    3|    1|
|Hornet Sportabout | 18.7|   8|  360| 175| 3.15| 3.440| 17.02|  0|  0|    3|    2|
|Valiant           | 18.1|   6|  225| 105| 2.76| 3.460| 20.22|  1|  0|    3|    1|


# Code chunk customisation

Naming code chunks can be useful for keeping tabs on them, and can be done with a label right after the language is specified: 

`` ```{r chunk1} ``

When initiating a code chunk, options can be set to define how a chunk should be processed and displayed. This is done within the brackets as you specify the language, with each option separated by a comma (`,`): 

`` ```{r, option1 = TRUE, option2 = FALSE} ``

A list of the available options and what each does is available from the [R markdown cheat sheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf) and [knitr options](https://yihui.name/knitr/options/). 

If you want an option specified for all chunks within a document, you can set it globally, using `opts_chunk$set();` within a code chunk. 


````
```{r}
opts_chunk$set(echo = FALSE)
```
````




# Resources

- [R markdown by RStudio, getting started](http://rmarkdown.rstudio.com/lesson-1.html)
- [R markdown html documents](http://rmarkdown.rstudio.com/html_document_format.html)
- [R markdown cheatsheet by RStudio](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf)

